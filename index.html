<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Editor</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <style>
        .icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        .icon-edit { 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z'/%3E%3C/svg%3E");
        }
        .icon-download { 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 10v6m0 0l-3-3m3 3l3-3M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2z'/%3E%3C/svg%3E");
        }
        .icon-file { 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z'/%3E%3C/svg%3E");
        }
        .icon-eye { 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15 12a3 3 0 11-6 0 3 3 0 016 0z'/%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z'/%3E%3C/svg%3E");
        }
        .icon-plus { 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 6v6m0 0v6m0-6h6m-6 0H6'/%3E%3C/svg%3E");
        }
        .icon-minus { 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M20 12H4'/%3E%3C/svg%3E");
        }
        .icon-upload { 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12'/%3E%3C/svg%3E");
        }
        .icon-save { 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4'/%3E%3C/svg%3E");
        }
        .icon-trash { 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16'/%3E%3C/svg%3E");
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        // Icon components
        const Edit3 = ({ size = 20 }) => React.createElement("span", { 
          className: "icon icon-edit", 
          style: { width: size + 'px', height: size + 'px' }
        });
        const Download = ({ size = 20 }) => React.createElement("span", { 
          className: "icon icon-download", 
          style: { width: size + 'px', height: size + 'px' }
        });
        const FileText = ({ size = 20 }) => React.createElement("span", { 
          className: "icon icon-file", 
          style: { width: size + 'px', height: size + 'px' }
        });
        const Eye = ({ size = 20 }) => React.createElement("span", { 
          className: "icon icon-eye", 
          style: { width: size + 'px', height: size + 'px' }
        });
        const Plus = ({ size = 16 }) => React.createElement("span", { 
          className: "icon icon-plus", 
          style: { width: size + 'px', height: size + 'px' }
        });
        const Minus = ({ size = 16 }) => React.createElement("span", { 
          className: "icon icon-minus", 
          style: { width: size + 'px', height: size + 'px' }
        });
        const Upload = ({ size = 20 }) => React.createElement("span", { 
          className: "icon icon-upload", 
          style: { width: size + 'px', height: size + 'px' }
        });
        const Save = ({ size = 20 }) => React.createElement("span", { 
          className: "icon icon-save", 
          style: { width: size + 'px', height: size + 'px' }
        });
        const Trash = ({ size = 20 }) => React.createElement("span", { 
          className: "icon icon-trash", 
          style: { width: size + 'px', height: size + 'px' }
        });

        const defaultResumeData = {
          name: "Your Name",
          contact: {
            email: "your.email@example.com",
            phone: "Your Phone Number"
          },
          profile: "Write your professional summary here. This should be a brief overview of your experience, skills, and career objectives. Keep it concise and impactful.",
          experience: [
            {
              title: "Job Title",
              company: "Company Name",
              location: "City, State",
              period: "Start Date â€” End Date",
              responsibilities: [
                "Add your key responsibilities and achievements here",
                "Use bullet points to describe your accomplishments",
                "Quantify your results where possible"
              ]
            }
          ],
          education: [
            {
              degree: "Your Degree",
              institution: "University/School Name",
              grade: "GPA or Grade",
              year: "Graduation Year"
            }
          ],
          skills: [
            "Skill 1",
            "Skill 2",
            "Skill 3",
            "Skill 4",
            "Add more skills as needed"
          ]
        };

        // Storage utilities
        const StorageManager = {
          STORAGE_KEY: 'resumeEditor',
          CURRENT_SLOT_KEY: 'currentResumeSlot',
          
          saveResume(slotName, data) {
            const allResumes = this.getAllResumes();
            allResumes[slotName] = {
              data,
              lastModified: new Date().toISOString()
            };
            localStorage.setItem(this.STORAGE_KEY, JSON.stringify(allResumes));
            localStorage.setItem(this.CURRENT_SLOT_KEY, slotName);
          },
          
          loadResume(slotName) {
            const allResumes = this.getAllResumes();
            return allResumes[slotName]?.data || null;
          },
          
          getAllResumes() {
            const data = localStorage.getItem(this.STORAGE_KEY);
            return data ? JSON.parse(data) : {};
          },
          
          deleteResume(slotName) {
            const allResumes = this.getAllResumes();
            delete allResumes[slotName];
            localStorage.setItem(this.STORAGE_KEY, JSON.stringify(allResumes));
          },
          
          getCurrentSlot() {
            return localStorage.getItem(this.CURRENT_SLOT_KEY) || 'default';
          },
          
          setCurrentSlot(slotName) {
            localStorage.setItem(this.CURRENT_SLOT_KEY, slotName);
          }
        };

        // Document parser
        const DocumentParser = {
          async parsePDF(file) {
            return new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.onload = async (e) => {
                try {
                  const typedArray = new Uint8Array(e.target.result);
                  const pdf = await pdfjsLib.getDocument(typedArray).promise;
                  let fullText = '';
                  
                  for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += pageText + '\n';
                  }
                  
                  resolve(this.parseText(fullText));
                } catch (error) {
                  reject(error);
                }
              };
              reader.onerror = reject;
              reader.readAsArrayBuffer(file);
            });
          },
          
          async parseWord(file) {
            return new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.onload = async (e) => {
                try {
                  const arrayBuffer = e.target.result;
                  const result = await mammoth.extractRawText({ arrayBuffer });
                  resolve(this.parseText(result.value));
                } catch (error) {
                  reject(error);
                }
              };
              reader.onerror = reject;
              reader.readAsArrayBuffer(file);
            });
          },
          
          parseText(text) {
            const lines = text.split('\n').map(line => line.trim()).filter(line => line);
            
            const resumeData = {
              name: "",
              contact: { email: "", phone: "" },
              profile: "",
              experience: [],
              education: [],
              skills: []
            };
            
            // Extract email and phone
            const emailRegex = /[\w.-]+@[\w.-]+\.\w+/;
            const phoneRegex = /[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}/;
            
            let currentSection = null;
            let currentExp = null;
            let currentEdu = null;
            
            for (let i = 0; i < lines.length; i++) {
              const line = lines[i];
              const lowerLine = line.toLowerCase();
              
              // Extract email
              if (!resumeData.contact.email) {
                const emailMatch = line.match(emailRegex);
                if (emailMatch) resumeData.contact.email = emailMatch[0];
              }
              
              // Extract phone
              if (!resumeData.contact.phone) {
                const phoneMatch = line.match(phoneRegex);
                if (phoneMatch) resumeData.contact.phone = phoneMatch[0];
              }
              
              // Extract name (usually first non-empty line)
              if (!resumeData.name && i < 5 && line.length > 3 && line.length < 50 && !line.includes('@')) {
                if (!lowerLine.includes('resume') && !lowerLine.includes('cv') && !phoneRegex.test(line)) {
                  resumeData.name = line;
                  continue;
                }
              }
              
              // Detect sections
              if (lowerLine.includes('experience') || lowerLine.includes('employment') || lowerLine.includes('work history')) {
                currentSection = 'experience';
                if (currentExp) resumeData.experience.push(currentExp);
                currentExp = null;
                continue;
              } else if (lowerLine.includes('education') || lowerLine.includes('academic')) {
                currentSection = 'education';
                if (currentExp) resumeData.experience.push(currentExp);
                currentExp = null;
                continue;
              } else if (lowerLine.includes('skill') || lowerLine.includes('technical') || lowerLine.includes('competenc')) {
                currentSection = 'skills';
                if (currentExp) resumeData.experience.push(currentExp);
                if (currentEdu) resumeData.education.push(currentEdu);
                currentExp = null;
                currentEdu = null;
                continue;
              } else if (lowerLine.includes('summary') || lowerLine.includes('profile') || lowerLine.includes('objective')) {
                currentSection = 'profile';
                continue;
              }
              
              // Parse content based on section
              if (currentSection === 'profile' && line.length > 20) {
                resumeData.profile += (resumeData.profile ? ' ' : '') + line;
              } else if (currentSection === 'experience') {
                // Check if this is a new job (usually has date range)
                const datePattern = /\d{4}|present|current/i;
                if (datePattern.test(line) && line.length < 100) {
                  if (currentExp) resumeData.experience.push(currentExp);
                  currentExp = {
                    title: lines[i-1] || "",
                    company: "",
                    location: "",
                    period: line,
                    responsibilities: []
                  };
                } else if (currentExp && line.startsWith('â€¢') || line.startsWith('-') || line.startsWith('*')) {
                  currentExp.responsibilities.push(line.replace(/^[â€¢\-*]\s*/, ''));
                } else if (currentExp && line.length > 15 && !currentExp.company) {
                  currentExp.company = line;
                }
              } else if (currentSection === 'education') {
                if (!currentEdu || line.length > 20) {
                  if (currentEdu) resumeData.education.push(currentEdu);
                  currentEdu = {
                    degree: line,
                    institution: lines[i+1] || "",
                    grade: "",
                    year: ""
                  };
                  const yearMatch = line.match(/\d{4}/);
                  if (yearMatch) currentEdu.year = yearMatch[0];
                }
              } else if (currentSection === 'skills') {
                const skills = line.split(/[,|â€¢\-*]/);
                skills.forEach(skill => {
                  const trimmed = skill.trim();
                  if (trimmed.length > 1 && !trimmed.toLowerCase().includes('skill')) {
                    resumeData.skills.push(trimmed);
                  }
                });
              }
            }
            
            // Push remaining items
            if (currentExp) resumeData.experience.push(currentExp);
            if (currentEdu) resumeData.education.push(currentEdu);
            
            // Clean up
            if (!resumeData.name) resumeData.name = "Your Name";
            if (!resumeData.profile) resumeData.profile = "Professional summary not found in document";
            if (resumeData.experience.length === 0) {
              resumeData.experience = [{ title: "", company: "", location: "", period: "", responsibilities: [""] }];
            }
            if (resumeData.education.length === 0) {
              resumeData.education = [{ degree: "", institution: "", grade: "", year: "" }];
            }
            if (resumeData.skills.length === 0) {
              resumeData.skills = [""];
            }
            
            return resumeData;
          }
        };

        const ResumeEditor = () => {
          const [isEditing, setIsEditing] = useState(false);
          const [isGeneratingPDF, setIsGeneratingPDF] = useState(false);
          const [currentSlot, setCurrentSlot] = useState(StorageManager.getCurrentSlot());
          const [showSaveDialog, setShowSaveDialog] = useState(false);
          const [showLoadDialog, setShowLoadDialog] = useState(false);
          const [newSlotName, setNewSlotName] = useState('');
          const [isUploading, setIsUploading] = useState(false);
          const fileInputRef = useRef(null);
          
          const [resumeData, setResumeData] = useState(() => {
            const saved = StorageManager.loadResume(currentSlot);
            return saved || defaultResumeData;
          });

          // Auto-save on data change
          useEffect(() => {
            const timer = setTimeout(() => {
              StorageManager.saveResume(currentSlot, resumeData);
            }, 1000);
            return () => clearTimeout(timer);
          }, [resumeData, currentSlot]);

          const updateField = (path, value) => {
            setResumeData(prev => {
              const newData = { ...prev };
              const keys = path.split('.');
              let current = newData;
              
              for (let i = 0; i < keys.length - 1; i++) {
                current = current[keys[i]];
              }
              
              current[keys[keys.length - 1]] = value;
              return newData;
            });
          };

          const handleFileUpload = async (event) => {
            const file = event.target.files[0];
            if (!file) return;
            
            setIsUploading(true);
            
            try {
              let parsedData;
              
              if (file.type === 'application/pdf') {
                parsedData = await DocumentParser.parsePDF(file);
              } else if (file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' || 
                         file.type === 'application/msword') {
                parsedData = await DocumentParser.parseWord(file);
              } else {
                alert('Please upload a PDF or Word document');
                setIsUploading(false);
                return;
              }
              
              setResumeData(parsedData);
              alert('Resume parsed successfully! Please review and edit as needed.');
            } catch (error) {
              console.error('Error parsing document:', error);
              alert('Error parsing document. Please try again or enter data manually.');
            } finally {
              setIsUploading(false);
              if (fileInputRef.current) fileInputRef.current.value = '';
            }
          };

          const saveToSlot = (slotName) => {
            StorageManager.saveResume(slotName, resumeData);
            setCurrentSlot(slotName);
            setShowSaveDialog(false);
            setNewSlotName('');
          };

          const loadFromSlot = (slotName) => {
            const data = StorageManager.loadResume(slotName);
            if (data) {
              setResumeData(data);
              setCurrentSlot(slotName);
              setShowLoadDialog(false);
            }
          };

          const deleteSlot = (slotName) => {
            if (confirm(`Delete resume "${slotName}"?`)) {
              StorageManager.deleteResume(slotName);
              if (slotName === currentSlot) {
                const allResumes = StorageManager.getAllResumes();
                const remaining = Object.keys(allResumes);
                if (remaining.length > 0) {
                  loadFromSlot(remaining[0]);
                } else {
                  setResumeData(defaultResumeData);
                  setCurrentSlot('default');
                }
              }
              setShowLoadDialog(false);
            }
          };

          const addExperience = () => {
            setResumeData(prev => ({
              ...prev,
              experience: [...prev.experience, {
                title: "",
                company: "",
                location: "",
                period: "",
                responsibilities: [""]
              }]
            }));
          };

          const removeExperience = (index) => {
            setResumeData(prev => ({
              ...prev,
              experience: prev.experience.filter((_, i) => i !== index)
            }));
          };

          const addResponsibility = (expIndex) => {
            setResumeData(prev => {
              const newExp = [...prev.experience];
              newExp[expIndex].responsibilities.push("");
              return { ...prev, experience: newExp };
            });
          };

          const removeResponsibility = (expIndex, respIndex) => {
            setResumeData(prev => {
              const newExp = [...prev.experience];
              newExp[expIndex].responsibilities = newExp[expIndex].responsibilities.filter((_, i) => i !== respIndex);
              return { ...prev, experience: newExp };
            });
          };

          const addEducation = () => {
            setResumeData(prev => ({
              ...prev,
              education: [...prev.education, {
                degree: "",
                institution: "",
                grade: "",
                year: ""
              }]
            }));
          };

          const removeEducation = (index) => {
            setResumeData(prev => ({
              ...prev,
              education: prev.education.filter((_, i) => i !== index)
            }));
          };

          const addSkill = () => {
            setResumeData(prev => ({
              ...prev,
              skills: [...prev.skills, ""]
            }));
          };

          const removeSkill = (index) => {
            setResumeData(prev => ({
              ...prev,
              skills: prev.skills.filter((_, i) => i !== index)
            }));
          };

          const generateHTML = () => {
            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${resumeData.name} - Resume</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.4;
            margin: 0;
            padding: 20px;
            font-size: 11px;
            color: #333;
            background: white;
        }
        
        .container {
            max-width: 8.5in;
            margin: 0 auto;
            background: white;
        }
        
        .header {
            text-align: left;
            margin-bottom: 15px;
            border-bottom: 3px solid #2E86C1;
            padding-bottom: 10px;
        }
        
        .name {
            font-size: 28px;
            font-weight: bold;
            color: #2E86C1;
            margin: 0;
            letter-spacing: 2px;
        }
        
        .contact {
            font-size: 11px;
            color: #555;
            margin-top: 5px;
        }
        
        .section {
            margin-bottom: 15px;
        }
        
        .section-title {
            font-size: 14px;
            font-weight: bold;
            color: #2E86C1;
            text-transform: uppercase;
            border-bottom: 2px solid #2E86C1;
            padding-bottom: 3px;
            margin-bottom: 8px;
            letter-spacing: 1px;
        }
        
        .job-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 2px;
        }
        
        .job-period {
            float: right;
            font-style: italic;
            color: #666;
            font-size: 10px;
        }
        
        .job-header {
            overflow: hidden;
            margin-bottom: 5px;
        }
        
        .job-description {
            margin-left: 0;
            margin-bottom: 10px;
        }
        
        .job-description li {
            margin-bottom: 3px;
            text-align: justify;
        }
        
        .education-item {
            margin-bottom: 8px;
        }
        
        .degree {
            font-weight: bold;
            color: #333;
        }
        
        .school {
            color: #555;
            font-size: 10px;
        }
        
        .skills-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 5px;
        }
        
        .skill-item {
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 10px;
            border: 1px solid #e9ecef;
        }
        
        .profile-text {
            text-align: justify;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        @media print {
            body { 
                font-size: 10px;
                padding: 10px;
            }
            .container {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="name">${resumeData.name}</h1>
            <div class="contact">
                ${resumeData.contact.email} | ${resumeData.contact.phone}
            </div>
        </div>

        <div class="section">
            <div class="section-title">Profile</div>
            <div class="profile-text">
                ${resumeData.profile}
            </div>
        </div>

        <div class="section">
            <div class="section-title">Professional Experience</div>
            ${resumeData.experience.map(exp => `
            <div class="job-header">
                <div class="job-title">${exp.title}, ${exp.company}, ${exp.location}</div>
                <div class="job-period">${exp.period}</div>
            </div>
            <ul class="job-description">
                ${exp.responsibilities.map(resp => `<li>${resp}</li>`).join('')}
            </ul>
            `).join('')}
        </div>

        <div class="section">
            <div class="section-title">Education</div>
            ${resumeData.education.map(edu => `
            <div class="education-item">
                <div class="degree">${edu.degree}</div>
                <div class="school">${edu.institution} ${edu.grade ? '- ' + edu.grade : ''}</div>
                <div class="job-period" style="float: right; margin-top: -15px;">${edu.year}</div>
            </div>
            `).join('')}
        </div>

        <div class="section">
            <div class="section-title">Technical Skills</div>
            <div class="skills-grid">
                ${resumeData.skills.map(skill => `<div class="skill-item">${skill}</div>`).join('')}
            </div>
        </div>
    </div>
</body>
</html>`;
          };

          const downloadHTML = () => {
            const htmlContent = generateHTML();
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${resumeData.name.replace(/\s+/g, '_')}_Resume.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          };

          const downloadPDF = async () => {
            setIsGeneratingPDF(true);
            
            try {
              const iframe = document.createElement('iframe');
              iframe.style.position = 'absolute';
              iframe.style.left = '-9999px';
              iframe.style.width = '210mm';
              iframe.style.height = '297mm';
              document.body.appendChild(iframe);
              
              const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
              const pdfHTML = generateHTML().replace(/font-size: 11px/g, 'font-size: 10px');
              
              iframeDoc.open();
              iframeDoc.write(pdfHTML);
              iframeDoc.close();
              
              await new Promise(resolve => setTimeout(resolve, 1000));
              iframe.contentWindow.print();
              
              setTimeout(() => {
                document.body.removeChild(iframe);
              }, 1000);
              
            } catch (error) {
              console.error('Error generating PDF:', error);
              alert('Error generating PDF. Please try the HTML download option.');
            } finally {
              setIsGeneratingPDF(false);
            }
          };

          const renderSaveDialog = () => {
            if (!showSaveDialog) return null;
            
            const allResumes = StorageManager.getAllResumes();
            
            return React.createElement("div", {
              className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",
              onClick: () => setShowSaveDialog(false)
            },
              React.createElement("div", {
                className: "bg-white rounded-lg p-6 max-w-md w-full mx-4",
                onClick: (e) => e.stopPropagation()
              },
                React.createElement("h3", { className: "text-xl font-bold mb-4" }, "Save Resume"),
                React.createElement("div", { className: "mb-4" },
                  React.createElement("label", { className: "block text-sm font-medium mb-2" }, "Resume Name"),
                  React.createElement("input", {
                    type: "text",
                    value: newSlotName,
                    onChange: (e) => setNewSlotName(e.target.value),
                    placeholder: "e.g., Software Engineer Resume",
                    className: "w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",
                    onKeyPress: (e) => {
                      if (e.key === 'Enter' && newSlotName.trim()) {
                        saveToSlot(newSlotName.trim());
                      }
                    }
                  })
                ),
                React.createElement("div", { className: "mb-4" },
                  React.createElement("p", { className: "text-sm text-gray-600 mb-2" }, "Existing Resumes:"),
                  React.createElement("div", { className: "max-h-40 overflow-y-auto space-y-1" },
                    Object.keys(allResumes).map(slotName =>
                      React.createElement("div", {
                        key: slotName,
                        className: "p-2 bg-gray-50 rounded cursor-pointer hover:bg-gray-100 text-sm",
                        onClick: () => {
                          setNewSlotName(slotName);
                        }
                      }, slotName)
                    )
                  )
                ),
                React.createElement("div", { className: "flex gap-2 justify-end" },
                  React.createElement("button", {
                    onClick: () => setShowSaveDialog(false),
                    className: "px-4 py-2 text-gray-600 hover:text-gray-800"
                  }, "Cancel"),
                  React.createElement("button", {
                    onClick: () => newSlotName.trim() && saveToSlot(newSlotName.trim()),
                    disabled: !newSlotName.trim(),
                    className: "px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"
                  }, "Save")
                )
              )
            );
          };

          const renderLoadDialog = () => {
            if (!showLoadDialog) return null;
            
            const allResumes = StorageManager.getAllResumes();
            const resumeList = Object.entries(allResumes);
            
            return React.createElement("div", {
              className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",
              onClick: () => setShowLoadDialog(false)
            },
              React.createElement("div", {
                className: "bg-white rounded-lg p-6 max-w-md w-full mx-4",
                onClick: (e) => e.stopPropagation()
              },
                React.createElement("h3", { className: "text-xl font-bold mb-4" }, "Load Resume"),
                resumeList.length === 0 ?
                  React.createElement("p", { className: "text-gray-600 text-center py-8" }, "No saved resumes found") :
                  React.createElement("div", { className: "space-y-2 max-h-96 overflow-y-auto" },
                    resumeList.map(([slotName, data]) =>
                      React.createElement("div", {
                        key: slotName,
                        className: "p-3 border border-gray-200 rounded hover:bg-gray-50 flex justify-between items-center"
                      },
                        React.createElement("div", {
                          className: "flex-1 cursor-pointer",
                          onClick: () => loadFromSlot(slotName)
                        },
                          React.createElement("div", { className: "font-semibold" }, slotName),
                          React.createElement("div", { className: "text-xs text-gray-500" },
                            new Date(data.lastModified).toLocaleString()
                          )
                        ),
                        React.createElement("button", {
                          onClick: () => deleteSlot(slotName),
                          className: "ml-2 text-red-600 hover:text-red-800"
                        },
                          React.createElement(Trash, { size: 16 })
                        )
                      )
                    )
                  ),
                React.createElement("div", { className: "flex justify-end mt-4" },
                  React.createElement("button", {
                    onClick: () => setShowLoadDialog(false),
                    className: "px-4 py-2 text-gray-600 hover:text-gray-800"
                  }, "Close")
                )
              )
            );
          };

          if (!isEditing) {
            return React.createElement("div", { className: "min-h-screen bg-gray-50 py-8" },
              React.createElement("div", { className: "max-w-4xl mx-auto bg-white rounded-lg shadow-lg overflow-hidden" },
                React.createElement("div", { className: "bg-blue-600 text-white p-6" },
                  React.createElement("h1", { className: "text-3xl font-bold" }, "Resume Editor"),
                  React.createElement("p", { className: "text-blue-100 mt-2" }, `Current: ${currentSlot}`)
                ),
                React.createElement("div", { className: "p-6" },
                  React.createElement("div", { className: "flex flex-wrap gap-2 mb-6" },
                    React.createElement("button", {
                      onClick: () => setIsEditing(true),
                      className: "flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
                    },
                      React.createElement(Edit3, { size: 20 }),
                      "Edit Resume"
                    ),
                    React.createElement("button", {
                      onClick: () => fileInputRef.current.click(),
                      disabled: isUploading,
                      className: "flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50"
                    },
                      React.createElement(Upload, { size: 20 }),
                      isUploading ? 'Uploading...' : 'Upload Resume'
                    ),
                    React.createElement("input", {
                      ref: fileInputRef,
                      type: "file",
                      accept: ".pdf,.doc,.docx",
                      onChange: handleFileUpload,
                      style: { display: 'none' }
                    }),
                    React.createElement("button", {
                      onClick: () => setShowSaveDialog(true),
                      className: "flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors"
                    },
                      React.createElement(Save, { size: 20 }),
                      "Save As"
                    ),
                    React.createElement("button", {
                      onClick: () => setShowLoadDialog(true),
                      className: "flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors"
                    },
                      React.createElement(Download, { size: 20 }),
                      "Load"
                    ),
                    React.createElement("button", {
                      onClick: downloadPDF,
                      disabled: isGeneratingPDF,
                      className: "flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50"
                    },
                      React.createElement(FileText, { size: 20 }),
                      isGeneratingPDF ? 'Generating...' : 'Download PDF'
                    ),
                    React.createElement("button", {
                      onClick: downloadHTML,
                      className: "flex items-center gap-2 bg-teal-600 text-white px-4 py-2 rounded-lg hover:bg-teal-700 transition-colors"
                    },
                      React.createElement(Download, { size: 20 }),
                      "Download HTML"
                    )
                  ),
                  React.createElement("div", { 
                    className: "bg-white border-2 border-gray-200 rounded-lg p-8", 
                    style: { minHeight: '800px' },
                    dangerouslySetInnerHTML: { __html: generateHTML() }
                  })
                ),
                renderSaveDialog(),
                renderLoadDialog()
              )
            );
          }

          return React.createElement("div", { className: "min-h-screen bg-gray-50 py-8" },
            React.createElement("div", { className: "max-w-6xl mx-auto bg-white rounded-lg shadow-lg overflow-hidden" },
              React.createElement("div", { className: "bg-blue-600 text-white p-6" },
                React.createElement("h1", { className: "text-3xl font-bold" }, "Resume Editor - Edit Mode"),
                React.createElement("p", { className: "text-blue-100 mt-1 text-sm" }, `Editing: ${currentSlot} (auto-saved)`),
                React.createElement("div", { className: "flex flex-wrap gap-2 mt-4" },
                  React.createElement("button", {
                    onClick: () => setIsEditing(false),
                    className: "flex items-center gap-2 bg-white text-blue-600 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors"
                  },
                    React.createElement(Eye, { size: 20 }),
                    "Preview"
                  ),
                  React.createElement("button", {
                    onClick: () => fileInputRef.current.click(),
                    disabled: isUploading,
                    className: "flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50"
                  },
                    React.createElement(Upload, { size: 20 }),
                    isUploading ? 'Uploading...' : 'Upload'
                  ),
                  React.createElement("input", {
                    ref: fileInputRef,
                    type: "file",
                    accept: ".pdf,.doc,.docx",
                    onChange: handleFileUpload,
                    style: { display: 'none' }
                  }),
                  React.createElement("button", {
                    onClick: () => setShowSaveDialog(true),
                    className: "flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors"
                  },
                    React.createElement(Save, { size: 20 }),
                    "Save As"
                  ),
                  React.createElement("button", {
                    onClick: () => setShowLoadDialog(true),
                    className: "flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors"
                  },
                    React.createElement(Download, { size: 20 }),
                    "Load"
                  ),
                  React.createElement("button", {
                    onClick: downloadPDF,
                    disabled: isGeneratingPDF,
                    className: "flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50"
                  },
                    React.createElement(FileText, { size: 20 }),
                    isGeneratingPDF ? 'PDF' : 'PDF'
                  ),
                  React.createElement("button", {
                    onClick: downloadHTML,
                    className: "flex items-center gap-2 bg-teal-600 text-white px-4 py-2 rounded-lg hover:bg-teal-700 transition-colors"
                  },
                    React.createElement(Download, { size: 20 }),
                    "HTML"
                  )
                )
              ),
              React.createElement("div", { className: "p-6 space-y-8" },
                // Personal Information section
                React.createElement("div", { className: "bg-gray-50 p-6 rounded-lg" },
                  React.createElement("h2", { className: "text-xl font-bold text-gray-800 mb-4" }, "Personal Information"),
                  React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                    React.createElement("div", null,
                      React.createElement("label", { className: "block text-sm font-medium text-gray-700 mb-2" }, "Full Name"),
                      React.createElement("input", {
                        type: "text",
                        value: resumeData.name,
                        onChange: (e) => updateField('name', e.target.value),
                        className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      })
                    ),
                    React.createElement("div", null,
                      React.createElement("label", { className: "block text-sm font-medium text-gray-700 mb-2" }, "Email"),
                      React.createElement("input", {
                        type: "email",
                        value: resumeData.contact.email,
                        onChange: (e) => updateField('contact.email', e.target.value),
                        className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      })
                    ),
                    React.createElement("div", null,
                      React.createElement("label", { className: "block text-sm font-medium text-gray-700 mb-2" }, "Phone"),
                      React.createElement("input", {
                        type: "text",
                        value: resumeData.contact.phone,
                        onChange: (e) => updateField('contact.phone', e.target.value),
                        className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      })
                    )
                  )
                ),
                
                // Profile section
                React.createElement("div", { className: "bg-gray-50 p-6 rounded-lg" },
                  React.createElement("h2", { className: "text-xl font-bold text-gray-800 mb-4" }, "Profile"),
                  React.createElement("textarea", {
                    value: resumeData.profile,
                    onChange: (e) => updateField('profile', e.target.value),
                    rows: 5,
                    className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  })
                ),
                
                // Experience section
                React.createElement("div", { className: "bg-gray-50 p-6 rounded-lg" },
                  React.createElement("div", { className: "flex justify-between items-center mb-4" },
                    React.createElement("h2", { className: "text-xl font-bold text-gray-800" }, "Professional Experience"),
                    React.createElement("button", {
                      onClick: addExperience,
                      className: "flex items-center gap-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition-colors text-sm"
                    },
                      React.createElement(Plus, { size: 16 }),
                      "Add Experience"
                    )
                  ),
                  ...resumeData.experience.map((exp, expIndex) =>
                    React.createElement("div", { key: expIndex, className: "border border-gray-200 p-4 rounded-lg mb-4 bg-white" },
                      React.createElement("div", { className: "flex justify-between items-start mb-4" },
                        React.createElement("h3", { className: "font-semibold text-gray-800" }, `Experience ${expIndex + 1}`),
                        React.createElement("button", {
                          onClick: () => removeExperience(expIndex),
                          className: "text-red-600 hover:text-red-800 transition-colors"
                        },
                          React.createElement(Minus, { size: 16 })
                        )
                      ),
                      React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4 mb-4" },
                        React.createElement("div", null,
                          React.createElement("label", { className: "block text-sm font-medium text-gray-700 mb-1" }, "Job Title"),
                          React.createElement("input", {
                            type: "text",
                            value: exp.title,
                            onChange: (e) => updateField(`experience.${expIndex}.title`, e.target.value),
                            className: "w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent text-sm"
                          })
                        ),
                        React.createElement("div", null,
                          React.createElement("label", { className: "block text-sm font-medium text-gray-700 mb-1" }, "Company"),
                          React.createElement("input", {
                            type: "text",
                            value: exp.company,
                            onChange: (e) => updateField(`experience.${expIndex}.company`, e.target.value),
                            className: "w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent text-sm"
                          })
                        ),
                        React.createElement("div", null,
                          React.createElement("label", { className: "block text-sm font-medium text-gray-700 mb-1" }, "Location"),
                          React.createElement("input", {
                            type: "text",
                            value: exp.location,
                            onChange: (e) => updateField(`experience.${expIndex}.location`, e.target.value),
                            className: "w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent text-sm"
                          })
                        ),
                        React.createElement("div", null,
                          React.createElement("label", { className: "block text-sm font-medium text-gray-700 mb-1" }, "Period"),
                          React.createElement("input", {
                            type: "text",
                            value: exp.period,
                            onChange: (e) => updateField(`experience.${expIndex}.period`, e.target.value),
                            className: "w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent text-sm"
                          })
                        )
                      ),
                      React.createElement("div", null,
                        React.createElement("div", { className: "flex justify-between items-center mb-2" },
                          React.createElement("label", { className: "block text-sm font-medium text-gray-700" }, "Responsibilities"),
                          React.createElement("button", {
                            onClick: () => addResponsibility(expIndex),
                            className: "flex items-center gap-1 bg-green-600 text-white px-2 py-1 rounded hover:bg-green-700 transition-colors text-xs"
                          },
                            React.createElement(Plus, { size: 12 }),
                            "Add"
                          )
                        ),
                        ...exp.responsibilities.map((resp, respIndex) =>
                          React.createElement("div", { key: respIndex, className: "flex gap-2 mb-2" },
                            React.createElement("textarea", {
                              value: resp,
                              onChange: (e) => {
                                const newExp = [...resumeData.experience];
                                newExp[expIndex].responsibilities[respIndex] = e.target.value;
                                setResumeData(prev => ({ ...prev, experience: newExp }));
                              },
                              rows: 2,
                              className: "flex-1 p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent text-sm"
                            }),
                            React.createElement("button", {
                              onClick: () => removeResponsibility(expIndex, respIndex),
                              className: "text-red-600 hover:text-red-800 transition-colors self-start mt-1"
                            },
                              React.createElement(Minus, { size: 16 })
                            )
                          )
                        )
                      )
                    )
                  )
                ),
                
                // Education section
                React.createElement("div", { className: "bg-gray-50 p-6 rounded-lg" },
                  React.createElement("div", { className: "flex justify-between items-center mb-4" },
                    React.createElement("h2", { className: "text-xl font-bold text-gray-800" }, "Education"),
                    React.createElement("button", {
                      onClick: addEducation,
                      className: "flex items-center gap-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition-colors text-sm"
                    },
                      React.createElement(Plus, { size: 16 }),
                      "Add Education"
                    )
                  ),
                  ...resumeData.education.map((edu, index) =>
                    React.createElement("div", { key: index, className: "border border-gray-200 p-4 rounded-lg mb-4 bg-white" },
                      React.createElement("div", { className: "flex justify-between items-start mb-4" },
                        React.createElement("h3", { className: "font-semibold text-gray-800" }, `Education ${index + 1}`),
                        React.createElement("button", {
                          onClick: () => removeEducation(index),
                          className: "text-red-600 hover:text-red-800 transition-colors"
                        },
                          React.createElement(Minus, { size: 16 })
                        )
                      ),
                      React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                        React.createElement("div", null,
                          React.createElement("label", { className: "block text-sm font-medium text-gray-700 mb-1" }, "Degree"),
                          React.createElement("input", {
                            type: "text",
                            value: edu.degree,
                            onChange: (e) => updateField(`education.${index}.degree`, e.target.value),
                            className: "w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent text-sm"
                          })
                        ),
                        React.createElement("div", null,
                          React.createElement("label", { className: "block text-sm font-medium text-gray-700 mb-1" }, "Institution"),
                          React.createElement("input", {
                            type: "text",
                            value: edu.institution,
                            onChange: (e) => updateField(`education.${index}.institution`, e.target.value),
                            className: "w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent text-sm"
                          })
                        ),
                        React.createElement("div", null,
                          React.createElement("label", { className: "block text-sm font-medium text-gray-700 mb-1" }, "Grade/Score"),
                          React.createElement("input", {
                            type: "text",
                            value: edu.grade,
                            onChange: (e) => updateField(`education.${index}.grade`, e.target.value),
                            className: "w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent text-sm"
                          })
                        ),
                        React.createElement("div", null,
                          React.createElement("label", { className: "block text-sm font-medium text-gray-700 mb-1" }, "Year"),
                          React.createElement("input", {
                            type: "text",
                            value: edu.year,
                            onChange: (e) => updateField(`education.${index}.year`, e.target.value),
                            className: "w-full p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent text-sm"
                          })
                        )
                      )
                    )
                  )
                ),

                // Skills section
                React.createElement("div", { className: "bg-gray-50 p-6 rounded-lg" },
                  React.createElement("div", { className: "flex justify-between items-center mb-4" },
                    React.createElement("h2", { className: "text-xl font-bold text-gray-800" }, "Technical Skills"),
                    React.createElement("button", {
                      onClick: addSkill,
                      className: "flex items-center gap-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition-colors text-sm"
                    },
                      React.createElement(Plus, { size: 16 }),
                      "Add Skill"
                    )
                  ),
                  React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                    ...resumeData.skills.map((skill, index) =>
                      React.createElement("div", { key: index, className: "flex gap-2" },
                        React.createElement("input", {
                          type: "text",
                          value: skill,
                          onChange: (e) => {
                            const newSkills = [...resumeData.skills];
                            newSkills[index] = e.target.value;
                            setResumeData(prev => ({ ...prev, skills: newSkills }));
                          },
                          className: "flex-1 p-2 border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-transparent text-sm"
                        }),
                        React.createElement("button", {
                          onClick: () => removeSkill(index),
                          className: "text-red-600 hover:text-red-800 transition-colors"
                        },
                          React.createElement(Minus, { size: 16 })
                        )
                      )
                    )
                  )
                )
              ),
              renderSaveDialog(),
              renderLoadDialog()
            )
          );
        };

        // Initialize PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        ReactDOM.render(React.createElement(ResumeEditor), document.getElementById('root'));
    </script>
</body>
</html>